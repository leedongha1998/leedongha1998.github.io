[toc]

#### Framework

###### Framework란?

{: .notice--info}

소프트웨어를 개발함에 있어 코드를 구현하는 개발 시간을 줄이고, 코드의 재사용성을 증가시키기 위해 일련의 클래스 묶음이나 뼈대, 틀을 제공하는 라이브러리를 구현해 놓은 것.



###### Framework 특징

1. 개발자가 따라야 하는 가이드를 제공.
2. 개발할 수 있는 범위가 정해져 있다.
3. 개발자를 위한 다양한 도구, 플러그인 지원



###### Framework 종류

1. 영속성 : 데이터 저장, 조회, 변경, 삭제를 다룸 ex) Mybatis, Hibernate
2. 자바 : Java EE를 통한 웹 어플리케이션 개발에 초점을 맞춤 ex) Spring
3. 화면 구현 : Front-End를 보다 쉽게 구현 ex) Bootstrap, Foundation, react js, vue js
4. 기능 및 지원 : 특정 기능이나 업무 수행에 도움을 줌 ex) Log4j, JUnit 5, ANT



#### Mybatis

###### Mybatis란?

{: .notice--info}

데이터의 CRUD를 보다 편하게 사용하기 위해 xml로 구조화된 Mapper 설정 파일을 통해서 JDBC를 구현한 영속성 프레임워크이다.



###### Mybatis 흐름

![image-20221121214503723](C:\Users\eedon\AppData\Roaming\Typora\typora-user-images\image-20221121214503723.png)



###### Mybatis 동작 구조

Session Factory Builder가 mybatis-config.xml 참조(class의 alias설정, db 연결 설정, sql 구문 경로 설정 등)하여 session factory 생성

----->  Session Factory 가 session 생성 

-----> Session이 mapper.xml 참조(sql 구문 설정(인자값, 결과값, 데이터 타입 등))

-----> (selectOne, selectList, selectMap, insert, delete, update 실행)                                            



###### Mybatis-config 설정하기

1. src/mybatis 폴더를 생성하고, mybatis-config.xml 파일 등록

2. mybatis-config.xml 작성 (mybatis 사이트에서 형식 보고 알맞게 사용)

    <a href="https://mybatis.org/mybatis-3/ko/index.html">마이바티스</a>

3. mapper 파일 생성 및 설정(쿼리 실행이 필요한 model의 위치에 mapper 폴더를 생성하고 식별하기 쉬운 이름으로 파일 등록)



###### mapper 태그

1. resultMap 태그 : 조회한 결과를 객체와 Row간의 1:1 매칭이 아닌, 원하는 객체의 필드에 담아 반환하고자 할 때 사용한다.

   ```java
   <resultMap id="resultMember" type="Member">
       <!-- prop은 필드명, column은 db 컬럼명-->
       <id property="id" column="ID"/>
       <result property="passwd" column="PASSWD"/>
   </resultMap>
   ```

2. select 태그 : sql의 조회 구문을 작성할 때 쓰인다. 해당 쿼리를 외부에서 접근하고자 할 때 namespace.ID명을 적어 접근이 가능하다

   - select 태그의 주요 속성
     - id : 구문을 찾기 위해 사용될 수 있는 네임 스페이스 내 유일한 구분자
     - parameterType : 구문에 전달될 파라미터의 클래스명(패키지 경로 포함)이나 별칭
     - resultType : 리턴되는 타입의 패키지 경로를 포함한 전체 클래스명이나 별칭. collection인 경우, list, arrayList로 설정할 수 있다.
     - resultMap : 사용할 resultMap의 id를 기술한다.

   ```java
   <select id="memberInfo" parameterType="string" resultType="_int"/>
      select * from member where id = #{userid}
   </select>
   ```



###### Mybatis SqlSessionFactory 생성

- Mybatis-config.xml, mapper.xml 파일 생성을 완료했다면, DAO에서 세션 생성을 위한 getSqlSessoinFactory() 메소드를 작성한다.

  ```java
  private SqlSessionFactory getSqlSessoin(){
      
      String resource = "mybatis/mybatis-config.xml";
      SqlSessionFactory factory = null;
      try{
          // mybatis-config.xml의 설정 정보를 inputStream 객체를 통해 읽어와 SqlSessionFactory 객체를 생성한다.
          InputStream inputStream = Resources.getResourceAsStream(resource);
          SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
          factory = builder.build(inputStream);
      }catch(IOException e){
  
      }
      return factory;
  }
  ```



###### Mybatis SqlSession 생성

- Dao 메소드는 SqlSessionFactory를 사용하여 SqlSession 객체를 생성한다.

  ```java
  public Member selectMember(Member m){
      Member member = null;
      SqlSession session = null;
      
      try{
          // getSqlSessionFactory() 메소드를 통해 세션 정보를 받아와 SqlSession을 생성한다.
          session = getSqlSessionFactory().openSession(false);
          
          // 매퍼 파일 안에 작성된 쿼리문 실행시키고 결과를 받는다.
          member = session.selectOne("Member.loginCheck", m);
          System.out.println(session);
      }catch(Exception e){
          e.printStackTrace();
      }finally{
          session.close();
      }
      return member;
  }
  ```



###### Mybatis 동적 쿼리



if,when의 test 속성에는 && || < > <= >= 연산자 사용 불가 -> and, or, lt, gt, le, ge 사용할 것



<where></where> : 시작하는 and 나 or 을 제거해준다. where 태그 내부의 if 문이 모두 false 인 경우 where 키워드를 제거해준다.



#### Log4j

###### log4j의 레벨들

- fatal : 아주 심각한 에러
- error : 처리 도중 오류(예외) 발생
- warn : 현재 프로그램 실행에는 문제되지는 않지만, 향후 시스템의 잠재적 오류가 될 수 있는 경우
- info : 프로그램 실행 중에 상태변경과 같은 메세지
- debug : 개발 도중 필요한 메세지
- trace : 흐름의 시작과 끝을 정의하는 용도



###### log4j 사용법

<a href="https://cluster-taek.tistory.com/entry/log4j%EC%9D%98-%EA%B0%9C%EB%85%90%EA%B3%BC-%EC%82%AC%EC%9A%A9%EB%B2%95">참고 사이트</a>

```java
// 로그 수집 주체
<logger name = "com.kh.app">
    <level value ="info"/>
</logger>
```



#### MAVEN

###### MAVEN이란?

자바용 프로젝트 관리 도구, (POM) XML 문서를 통해 해당 프로젝트의 버전 정보 및 라이브러리 정보들을 통합하여 관리하는 프레임워크.



지역 저장소에 저장해준다 (C -> 사용자 -> .m2 디렉토리에 저장됨)



###### pom 이란?

{: .notice--info}

POM(Project Object Model)은 하나의 프로젝트에서 사용하는 자바 버전, 라이브러리, 플러그인 구성을 통합하여 관리할 수 있게 각 설정 정보를 xml 문서화 한 것을 말한다.



pom.xml에 의존 등록

```java
<dependencies>

	<dependency>

		여기 위치에 메이븐 사이트에서 의존 붙여넣기

	</dependency>

</dependencies>
```



###### Maven target 폴더

Maven을 사용할 경우 프로젝트 커맢일 시 target/classess 안에 컴파일 된 클래스 파일들이 위치하게 된다.

일반적으로 maven clean 옵션을 사용하면 제거되어 문제는 없지만, 이후 형상관리를 위해 프로젝트를 공유할 시 컴파일 된 결과까지 공유할 필요는 없기 때문에 target 폴더를 공유 목록에서 제외하는 ignore 작업을 설정하자.



###### replection api

jdk의 기본 기능 중 하나. 

- 클래스 객체를 통해서 클래스 정보 열람.

- 객체를 생성.

- 메소드를 호출. 

- 필드 값 제어 처리.



클래스 객체

- 클래스 당 하나 씩 만들어지는 객체로 클래스의 모든 정보를 가지고 있다.
- new 연산자 호출시에도 이 클래스 객체를 베이스로 객체가 생성된다.



**객체 생성**

```java
// 기존 객체 생성
Sample s1 = new Sample();

// 클래스 객체 생성
Class clz1 = Sample.class;
Class clz2 = s1.getClass();
Class clz3 = Class.forName("com.kh.app.reflection.api.Sample"); // 예외 처리해줘야 함.

System.out.print(clz1 == clz2); // true
System.out.print(clz1 == clz3); // true

// 기본 생성자
Constructor<Sample> const1 = clz1.getDeclaredConstructor(null);
Sample s2 = const1.newInstance(null);

//파라미터 생성자
Class[] parameterTypes = {int.class, String.class};
Constructor<Sample> const2 = clz1.getDeclaredConstructor(parmeterTypes);
Object[] initArgs = {100, "helloworld"};
Sample s3 = const2.newInstance(initArgs);
```



###### 메소드 제어

```java
Class<Sample> clz = Sample.class;
Method[] methods = clz.getDeclaredMethods();
for(Method method : methods){
    System.out.println(method);
}

// 하나의 메소드 가져오기
Sample sample = clz.getDeclaredConstructor(null).newInstance(null);

//setNum 메소드 가져오기
Method setNum = clz.getDeclaredMethod("setNum",int.class);
setNum.invoke(sample, 123);

// getNum 메소드 가져오기
Method getNum = clz.getDeclaredMethod("getNum",null);
Object returnValue = getNum.invoke(sample);

System.out.print(returnValue); // 123
System.out.print(sample); // 123
```



###### 필드 제어

```java
Class<Sample> clz =(Class<Sample>)Class.forName("com.kh.app.reflection.api.Sample");

Sample sample = clz.getDeclaredConstructor(int.class, String.class).newInstance(123,"wow");
Field num = clz.getDeclaredField("num");
System.out.println(num); // 필드 정보도 tostring 처리 되어 보여진다.

num.setAccessible(true); // private필드도 접근 가능하게 해준다.

Object value = num.get(sample);
System.out.println(value);

System.out.println(sample); // Sample[num = 123, str = Wow]

```







#### selectOne, selectList

###### resultMap





#### Lombok

###### Lombok 설치

(버전이 안맞아서 적용 안될 수 있으니 주의!)

1. maven repository 에서 lombok 의존 복사
2. pom.xml에 붙여넣기
3. pom.xml에 표시된 lombok 설치된 경로에 가서 jar파일을 복사해서 eclipse 실행 파일에 붙여넣기
4. 해당 경로에서 cmd 열고 java -jar lombo-(버전).jar 실행
5. Specify location 선택 후 eclipse.exe 선택 후 install
6. eclipse 파일 안에 eclipse.ini 마지막 줄에 롬복 설치 문장 추가된 것 확인하기



###### lombok 활용

보통 클래스 레벨에 @Getter, @Setter 등등 어노테이션을 통하여 관리 가능. -> eclipse outline에서 확인 가능

- @Getter
- @Setter
- @NoArgsConstructor
- @AllArgsConstructor
- @ToString
- @Log4j
- @RequiredArgsConstructor : 꼭 필요한 인자만 받는 생성자.























#### 토비의 스프링 공부

###### How to Study

{: .notice -- info}

스프링을 직접 사용해서 개발을 해야 하는 단계
핵심을 파악할 것
=> IoC 컨테이너, AOP, 추상화 계층(MVC, JDBC, Resource, O/X M, O/J M 등등)
=> 예제 코드 하나씩은 직접 짜볼 것
=> 이거 이해하고 짜보는데 그 두꺼운 책이나 레퍼런스를 다 읽을 필요가 없다.
취업이 목표라면 이정도 단계여도 하는데 문제는 없다.
토비의 스프링을 전부 보는게 아니라 필요한 부분만 보는 것
=> Controller의 계층구조는 상속구조로 만드는 내용 같은건 스킵 하는게 좋다.
이정도까지 공부하면 누구한테도 설명이 가능한 정도



##### 오브젝트와 의존관계

###### 포인트

1. 어플리케이션에서 오브젝트가 생성되고 다른 오브젝트와 관계를 맺고, 사용되고, 소멸되기까지의 전 과정을 공부해보자

2. 오브젝트는 어떻게 설계되어야 하는지, 어떤 단위로 만들어지며 어떤 과정을 통해 자신의 존재를 드러내고 등장해야 되는지 공부

   

###### 초난감 DAO	

자바빈

- 디폴트 생성자 : 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 한다. 툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문에 필요하다.
- 프로퍼티 : 자바빈이 노출하는 이름을 가진 속성을 프로퍼티라고 한다. 프로퍼티는 set으로 시작하는 setter와 get으로 시작하는 getter를 이용해 수정 또는 조회할 수 있다.



JDBC를 이용하는 작업의 일반적인 순서

1. DB 연결을 위한 Connection을 가져온다.
2. SQL을 담은 Statement(PreparedStatement)를 만든다.
3. 만들어진 Statement를 실행
4. 조회의 경우 sql 쿼리의 실행결과를 ResultSet으로 받아서 정보를 저장할 오브젝트에 옮겨준다.
5. 작업 중에 생성된 Connection, Statement, ResultSet 같은 리소스는 작업을 마친 후 반드시 닫아준다.
6. JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 throws를 선언하여 예외가 발생하면 메소드 밖으로 던지게 한다.



###### DAO의 분리

리펙토링

리펙토링은 기존의 코드를 외부의 동작방식에는 변화 없이 내부 구조를 변경해서 재구성하는 작업 또는 기술을 말한다. -> 생산성, 코드 품질, 유지보수에 유리



템플릿 메소드 패턴

​	상속을 통해 슈퍼클래스의 기능을 확장할 때 사용하는 가장 대표적인 방법. 변하지 않는 기능은 슈퍼클래스에 만들어두고 자주 변경되며 확장할 기능은 서브클래스에서 만들도록 한다.



###### 클래스의 분리





